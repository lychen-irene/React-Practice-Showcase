import{r as e,M as C,j as t,N as D,t as I,F as R}from"./index-HA38NPoK.js";import{a as r,S as f,L as P,D as _,P as B,b as U}from"./ProductsLoading-3UFuBn60.js";import{A as $,P as H,a as O,b as q,c as z}from"./Pagination-DMeC8c7K.js";const T=function(){return document.cookie.split("; ").find(function(n){return n.startsWith("hexToken=")})?.split("=")[1]},d=f.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:function(n){n.onmouseenter=f.stopTimer,n.onmouseleave=f.resumeTimer}}),m={data:{id:"",title:"",category:"",origin_price:"",price:"",unit:"",description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[],rate:""}},K=function(){const n="https://ec-course-api.hexschool.io/v2",p="eirene09",[o,c]=e.useState(function(){return T()?"loading":"unauth"}),[b,y]=e.useState([]),[L,k]=e.useState({}),[v,M]=e.useState(!1),[E,l]=e.useState(!1),[S,h]=e.useState(m.data),[N,w]=e.useState(""),i=e.useCallback(async function(s=!0,a=1){s&&l(!0);try{const j=await r.get(`${n}/api/${p}/admin/products?page=${a}`);y(j.data.products),k(j.data.pagination)}catch{d.fire({icon:"error",title:"Fail to load product list"})}finally{l(!1)}},[n,p]),g=e.useCallback(async function(){try{const s=T();if(s){r.defaults.headers.common.Authorization=s;const a=await r.post(`${n}/api/user/check`);await i(!1),c("auth")}}catch{setTimeout(function(){c("unauth")},0)}},[n,i]),A=e.useRef(!1);e.useEffect(function(){!A.current&&o==="loading"&&setTimeout(function(){g()},0)},[g,o]),e.useEffect(function(){const s=r.interceptors.response.use(function(a){return a},function(a){return a.response?.status===401&&(document.cookie="hexToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT;",c("unauth"),d.fire({icon:"error",title:"Token is invalid, please sign in again"})),Promise.reject(a)});return function(){r.interceptors.response.eject(s)}},[]);const u=e.useRef(null);e.useEffect(function(){o==="auth"&&(u.current=new C("#productModal",{keyboard:!1}),document.querySelector("#productModal").addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}))},[o]);const x=function(s,a){w(s),h(function(){return{...m.data,...a}}),u.current.show()},F=function(){u.current.hide()};return t.jsx(t.Fragment,{children:t.jsxs("div",{children:[t.jsx(D,{title:{titles:I}}),o==="loading"&&t.jsx("div",{className:"d-flex justify-content-center",children:t.jsx(P,{})}),o==="auth"&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"container-fluid my-4",children:t.jsxs("div",{className:"container",children:[t.jsxs("div",{className:"sticky-header py-2 my-4",children:[t.jsx($,{openProductModal:x,INITIAL_TEMPLATE_PRODUCT_DATA:m}),t.jsx(_,{})]}),t.jsx("div",{className:"table",children:t.jsx("table",{className:"table table-dark table-striped table-bordered border-secondary",children:E?t.jsx(B,{}):t.jsx(t.Fragment,{children:t.jsx(H,{products:b,openProductModal:x})})})})]})}),t.jsx(O,{pagination:L,onChange:s=>i(!0,s)})]}),o==="unauth"&&t.jsx("div",{className:"d-flex justify-content-center",children:v?t.jsx(P,{}):t.jsx(U,{Toast:d,getProducts:i,setAuthStatus:c,setIsLoginLoading:M})}),t.jsx(q,{modalType:N,ref:u,templateProductData:S,setTemplateProductData:h,closeProductModal:F,ProductModelContent:z,setIsProductsLoading:l,getProducts:i,Toast:d}),t.jsx(R,{})]})})};export{K as default};
