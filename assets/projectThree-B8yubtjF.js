import{r as e,M as F,j as t,N as D,t as I,F as R,c as B}from"./all-CIUxKhs6.js";import{S as f,a as r,L as P,D as _,P as U,b as $}from"./ProductsLoading-Dllw-WF_.js";import{A as H,P as O,a as q,b as z,c as G}from"./Pagination-nbdif8AX.js";const T=function(){return document.cookie.split("; ").find(function(s){return s.startsWith("hexToken=")})?.split("=")[1]},d=f.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:function(s){s.onmouseenter=f.stopTimer,s.onmouseleave=f.resumeTimer}}),m={data:{id:"",title:"",category:"",origin_price:"",price:"",unit:"",description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[],rate:""}},J=function(){const s="https://ec-course-api.hexschool.io/v2",p="eirene09",[a,c]=e.useState(function(){return T()?"loading":"unauth"}),[y,b]=e.useState([]),[L,k]=e.useState({}),[v,E]=e.useState(!1),[M,l]=e.useState(!1),[S,h]=e.useState(m.data),[N,w]=e.useState(""),i=e.useCallback(async function(n=!0,o=1){n&&l(!0);try{const j=await r.get(`${s}/api/${p}/admin/products?page=${o}`);b(j.data.products),k(j.data.pagination)}catch{d.fire({icon:"error",title:"Fail to load product list"})}finally{l(!1)}},[s,p]),x=e.useCallback(async function(){try{const n=T();if(n){r.defaults.headers.common.Authorization=n;const o=await r.post(`${s}/api/user/check`);await i(!1),c("auth")}}catch{setTimeout(function(){c("unauth")},0)}},[s,i]),A=e.useRef(!1);e.useEffect(function(){!A.current&&a==="loading"&&setTimeout(function(){x()},0)},[x,a]),e.useEffect(function(){const n=r.interceptors.response.use(function(o){return o},function(o){return o.response?.status===401&&(document.cookie="hexToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT;",c("unauth"),d.fire({icon:"error",title:"Token is invalid, please sign in again"})),Promise.reject(o)});return function(){r.interceptors.response.eject(n)}},[]);const u=e.useRef(null);e.useEffect(function(){a==="auth"&&(u.current=new F("#productModal",{keyboard:!1}),document.querySelector("#productModal").addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}))},[a]);const g=function(n,o){w(n),h(function(){return{...m.data,...o}}),u.current.show()},C=function(){u.current.hide()};return t.jsx(t.Fragment,{children:t.jsxs("div",{children:[t.jsx(D,{title:{titles:I}}),a==="loading"&&t.jsx("div",{className:"d-flex justify-content-center",children:t.jsx(P,{})}),a==="auth"&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"container-fluid my-4",children:t.jsxs("div",{className:"container",children:[t.jsxs("div",{className:"sticky-header py-2 my-4",children:[t.jsx(H,{openProductModal:g,INITIAL_TEMPLATE_PRODUCT_DATA:m}),t.jsx(_,{})]}),t.jsx("div",{className:"table",children:t.jsx("table",{className:"table table-dark table-striped table-bordered border-secondary",children:M?t.jsx(U,{}):t.jsx(t.Fragment,{children:t.jsx(O,{products:y,openProductModal:g})})})})]})}),t.jsx(q,{pagination:L,onChange:n=>i(!0,n)})]}),a==="unauth"&&t.jsx("div",{className:"d-flex justify-content-center",children:v?t.jsx(P,{}):t.jsx($,{Toast:d,getProducts:i,setAuthStatus:c,setIsLoginLoading:E})}),t.jsx(z,{modalType:N,ref:u,templateProductData:S,setTemplateProductData:h,closeProductModal:C,ProductModelContent:G,setIsProductsLoading:l,getProducts:i,Toast:d}),t.jsx(R,{})]})})};B.createRoot(document.getElementById("root")).render(t.jsx(e.StrictMode,{children:t.jsx(J,{})}));
