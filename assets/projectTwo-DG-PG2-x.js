import{r as n,j as e,N as E,t as $,F as B,c as I}from"./all-DAGqaRkU.js";import{S as h,a as o,L as y,D as A,P as R,b as z}from"./ProductsLoading-Dg9KhZfa.js";import{P as G,a as H}from"./ProductDetail-BBVZet8J.js";const P=function(){return document.cookie.split("; ").find(a=>a.startsWith("hexToken="))?.split("=")[1]},i=h.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:a=>{a.onmouseenter=h.stopTimer,a.onmouseleave=h.resumeTimer}}),J=function({onClick:a,isChecking:c}){return e.jsxs("button",{className:"btn btn-secondary mb-5",type:"button",onClick:a,disabled:c,children:[c&&e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"確認登入狀態"]})},O=function(){const a="https://ec-course-api.hexschool.io/v2",c="eirene09",[p,v]=n.useState({username:"",password:""}),[l,r]=n.useState(()=>P()?"loading":"unauth"),[S,T]=n.useState([]),[x,L]=n.useState(null),[C,j]=n.useState(!1),[N,g]=n.useState(!1),[w,k]=n.useState(!1),F=function(t){const{name:s,value:u}=t.target;v(m=>({...m,[s]:u}))},D=async function(t){try{t.preventDefault(),j(!0);const s=await o.post(`${a}/admin/signin`,p),{token:u,expired:m}=s.data;document.cookie=`hexToken=${u};expires=${new Date(m)};`,o.defaults.headers.common.Authorization=u,await d(!0),r("auth"),i.fire({icon:"success",title:"Signed in successfully"})}catch{r("unauth"),i.fire({icon:"error",title:"Failed to sign in"})}finally{j(!1)}},d=n.useCallback(async function(t=!0){t&&g(!0);try{const s=await o.get(`${a}/api/${c}/admin/products`);T(s.data.products)}catch{i.fire({icon:"error",title:"Failed to load product list"})}finally{g(!1)}},[a,c]),f=n.useCallback(async function(t=!0){t&&k(!0);try{const s=P();if(s){o.defaults.headers.common.Authorization=s;const u=await o.post(`${a}/api/user/check`);await d(!1),r("auth"),t&&i.fire({icon:"success",title:"Check success: token is valid"})}else r("unauth"),t&&i.fire({icon:"error",title:"Check failed: token not found, please sign in again"})}catch{setTimeout(function(){r("unauth")},0),t&&i.fire({icon:"error",title:"Check failed: token is invalid"})}finally{t&&k(!1)}},[a,d]),b=n.useRef(!1);return n.useEffect(function(){b.current||(b.current=!0,setTimeout(()=>{f(!1)},0))},[f]),n.useEffect(()=>{const t=o.interceptors.response.use(s=>s,s=>(s.response?.status===401&&(document.cookie="hexToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT;",r("unauth"),i.fire({icon:"error",title:"Token is invalid, please sign in again"})),Promise.reject(s)));return()=>{o.interceptors.response.eject(t)}},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx(E,{title:{titles:$}}),l==="loading"&&e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(y,{})}),l==="auth"&&e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"row mt-5 row-col-2",children:[e.jsxs("div",{className:"col",children:[e.jsx(J,{onClick:f,isChecking:w}),e.jsx(A,{}),e.jsx("table",{className:"table table-dark table-striped table-bordered border-secondary",children:N?e.jsx(R,{}):e.jsx(e.Fragment,{children:e.jsx(G,{products:S,setTempProduct:L})})})]}),e.jsxs("div",{className:"col",children:[e.jsx("h2",{children:"單一產品細節"}),x?e.jsx(H,{tempProduct:x}):e.jsx("p",{className:"text-secondary",children:"請選擇一個商品查看"})]})]})}),l==="unauth"&&e.jsx("div",{className:"d-flex justify-content-center",children:C?e.jsx(y,{}):e.jsx(z,{onSubmit:D,formData:p,onChange:F})}),e.jsx(B,{})]})})};I.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(O,{})}));
