import{r as s,j as e,N,t as C,F as S}from"./index-HA38NPoK.js";import{a as r,S as f,L as j,D as F,P as w,b as B}from"./ProductsLoading-3UFuBn60.js";import{P as E,a as D}from"./ProductDetail-Cwn1EEDA.js";const g=function(){return document.cookie.split("; ").find(t=>t.startsWith("hexToken="))?.split("=")[1]},c=f.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:t=>{t.onmouseenter=f.stopTimer,t.onmouseleave=f.resumeTimer}}),I=function({onClick:t,isChecking:i}){return e.jsxs("button",{className:"btn btn-secondary mb-5",type:"button",onClick:t,disabled:i,children:[i&&e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"確認登入狀態"]})},G=function(){const t="https://ec-course-api.hexschool.io/v2",i="eirene09",[u,o]=s.useState(()=>g()?"loading":"unauth"),[k,b]=s.useState([]),[m,P]=s.useState(null),[v,L]=s.useState(!1),[T,h]=s.useState(!1),[y,p]=s.useState(!1),l=s.useCallback(async function(n=!0){n&&h(!0);try{const a=await r.get(`${t}/api/${i}/admin/products`);b(a.data.products)}catch{c.fire({icon:"error",title:"Failed to load product list"})}finally{h(!1)}},[t,i]),d=s.useCallback(async function(n=!0){n&&p(!0);try{const a=g();if(a){r.defaults.headers.common.Authorization=a;const $=await r.post(`${t}/api/user/check`);await l(!1),o("auth"),n&&c.fire({icon:"success",title:"Check success: token is valid"})}else o("unauth"),n&&c.fire({icon:"error",title:"Check failed: token not found, please sign in again"})}catch{setTimeout(function(){o("unauth")},0),n&&c.fire({icon:"error",title:"Check failed: token is invalid"})}finally{n&&p(!1)}},[t,l]),x=s.useRef(!1);return s.useEffect(function(){x.current||(x.current=!0,setTimeout(()=>{d(!1)},0))},[d]),s.useEffect(()=>{const n=r.interceptors.response.use(a=>a,a=>(a.response?.status===401&&(document.cookie="hexToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT;",o("unauth"),c.fire({icon:"error",title:"Token is invalid, please sign in again"})),Promise.reject(a)));return()=>{r.interceptors.response.eject(n)}},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx(N,{title:{titles:C}}),u==="loading"&&e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(j,{})}),u==="auth"&&e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"row mt-5 row-col-2",children:[e.jsxs("div",{className:"col",children:[e.jsx(I,{onClick:d,isChecking:y}),e.jsx(F,{}),e.jsx("table",{className:"table table-dark table-striped table-bordered border-secondary",children:T?e.jsx(w,{}):e.jsx(e.Fragment,{children:e.jsx(E,{products:k,setTempProduct:P})})})]}),e.jsxs("div",{className:"col",children:[e.jsx("h2",{children:"單一產品細節"}),m?e.jsx(D,{tempProduct:m}):e.jsx("p",{className:"text-secondary",children:"請選擇一個商品查看"})]})]})}),u==="unauth"&&e.jsx("div",{className:"d-flex justify-content-center",children:v?e.jsx(j,{}):e.jsx(B,{getProducts:l,setAuthStatus:o,setIsLoginLoading:L})}),e.jsx(S,{})]})})};export{G as default};
