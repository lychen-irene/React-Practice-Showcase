import{r as o,M as J,j as n,N as W,t as K,F as Q,c as V}from"./all-DAGqaRkU.js";import{S as y,a as r,L as w,D as X,P as Y,b as Z}from"./ProductsLoading-B1Eh8Chz.js";import{A as ee,P as te,a as ne,b as se,c as ae}from"./Pagination-BgX8NW49.js";const v=function(){return document.cookie.split("; ").find(function(i){return i.startsWith("hexToken=")})?.split("=")[1]},c=y.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:function(i){i.onmouseenter=y.stopTimer,i.onmouseleave=y.resumeTimer}}),I={data:{id:"",title:"",category:"",origin_price:null,price:null,unit:"",description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[]}},oe=function(){const i="https://ec-course-api.hexschool.io/v2",d="eirene09",[j,L]=o.useState({username:"",password:""}),[f,l]=o.useState(function(){return v()?"loading":"unauth"}),[S,M]=o.useState([]),[$,E]=o.useState({}),[N,k]=o.useState(!1),[U,m]=o.useState(!1),[p,h]=o.useState(I.data),[C,D]=o.useState(""),A=function(t){const{name:e,value:a}=t.target;L(function(s){return{...s,[e]:a}})},F=async function(t){try{t.preventDefault(),k(!0);const e=await r.post(`${i}/admin/signin`,j),{token:a,expired:s}=e.data;document.cookie=`hexToken=${a};expires=${new Date(s)};`,r.defaults.headers.common.Authorization=a,await u(!0),l("auth"),c.fire({icon:"success",title:"Sign in successfully"})}catch{l("unauth"),c.fire({icon:"error",title:"Fail to sign in"})}finally{k(!1)}},u=o.useCallback(async function(t=!0,e=1){t&&m(!0);try{const a=await r.get(`${i}/api/${d}/admin/products?page=${e}`);M(a.data.products),E(a.data.pagination)}catch{c.fire({icon:"error",title:"Fail to load product list"})}finally{m(!1)}},[i,d]),_=async function(t,e=!0){e&&m(!0);const a={data:{...p,origin_price:Number(p.origin_price),price:Number(p.price),imagesUrl:[...p.imagesUrl.filter(s=>s!=="")]}};if(C==="create")try{const s=await r.post(`${i}/api/${d}/admin/product`,a);await u(!1),c.fire({icon:"success",title:"Create a new product successfully"})}catch{c.fire({icon:"error",title:"Fail to create a new product"})}finally{m(!1),x()}else try{const s=await r.put(`${i}/api/${d}/admin/product/${t}`,a);await u(!1),c.fire({icon:"success",title:"Update product successfully"})}catch{c.fire({icon:"error",title:"Fail to update product"})}finally{m(!1),x()}},R=async t=>{try{const e=await r.delete(`${i}/api/${d}/admin/product/${t}`);c.fire({icon:"success",title:"Delete product successfully"})}catch{c.fire({icon:"error",title:"Fail to delete product"})}finally{x(),u(!1)}},P=o.useCallback(async function(t=!0){try{const e=v();if(e){r.defaults.headers.common.Authorization=e;const a=await r.post(`${i}/api/user/check`);await u(!1),l("auth"),t&&c.fire({icon:"success",title:"Check success: token is valid"})}else l("unauth"),c.fire({icon:"error",title:"Check failed: token not found, please sign in again"})}catch{setTimeout(function(){l("unauth")},0),t&&c.fire({icon:"error",title:"Check failed: token is invalid"})}},[i,u]),T=o.useRef(!1);o.useEffect(function(){T.current||(T.current=!0,setTimeout(function(){P(!1)},0))},[P]),o.useEffect(function(){const t=r.interceptors.response.use(function(e){return e},function(e){return e.response?.status===401&&(document.cookie="hexToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT;",l("unauth"),c.fire({icon:"error",title:"Token is invalid, please sign in again"})),Promise.reject(e)});return function(){r.interceptors.response.eject(t)}},[]);const g=o.useRef(null);o.useEffect(function(){f==="auth"&&(g.current=new J("#productModal",{keyboard:!1}),document.querySelector("#productModal").addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}))},[f]);const b=function(t,e){D(t),h(function(a){return{...a,...e}}),g.current.show()},x=function(){g.current.hide()},B=function(t){const{name:e,value:a,checked:s,type:q}=t.target;h(function(G){return{...G,[e]:q==="checkbox"?s:a}})},z=function(t,e){h(function(a){const s=[...a.imagesUrl];return s[t]=e,e!==""&&t===s.length-1&&s.length<5&&s.push(""),e===""&&s.length>1&&s[s.length-1]===""&&s.pop(),{...a,imagesUrl:s}})},H=()=>{h(function(t){const e=[...t.imagesUrl];return e.push(""),{...t,imagesUrl:e}})},O=()=>{h(function(t){const e=[...t.imagesUrl];return e.pop(),{...t,imagesUrl:e}})};return n.jsx(n.Fragment,{children:n.jsxs("div",{children:[n.jsx(W,{title:{titles:K}}),f==="loading"&&n.jsx("div",{className:"d-flex justify-content-center",children:n.jsx(w,{})}),f==="auth"&&n.jsx("div",{className:"container-fluid my-4",children:n.jsxs("div",{className:"container",children:[n.jsxs("div",{className:"sticky-header py-2 my-4",children:[n.jsx(ee,{onClick:()=>b("create",I.data)}),n.jsx(X,{})]}),n.jsx("div",{className:"table",children:n.jsx("table",{className:"table table-dark table-striped table-bordered border-secondary",children:U?n.jsx(Y,{}):n.jsx(n.Fragment,{children:n.jsx(te,{products:S,openProductModal:b})})})})]})}),f==="unauth"&&n.jsx("div",{className:"d-flex justify-content-center",children:N?n.jsx(w,{}):n.jsx(Z,{onSubmit:F,formData:j,onChange:A})}),n.jsx(ne,{modalType:C,ref:g,onClick:x,templateProductData:p,onChange:B,onImgChange:z,onClickAddImg:H,onClickDeleteImg:O,updateProducts:_,deleteProductData:R,ProductModelContent:se}),n.jsx(ae,{pagination:$,onChange:t=>u(!0,t)}),n.jsx(Q,{})]})})};V.createRoot(document.getElementById("root")).render(n.jsx(o.StrictMode,{children:n.jsx(oe,{})}));
