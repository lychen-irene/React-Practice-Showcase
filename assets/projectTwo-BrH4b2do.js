import{r as a,j as e,N as $,t as B,F as I,c as A}from"./all-DQqp6yhR.js";import{S as f,a as c}from"./sweetalert2.esm.all-DOjieFrw.js";import"./bootstrap.esm-G50tnjl1.js";const D=function({onSubmit:s,formData:n,onChange:i}){return e.jsxs("div",{className:"container login",children:[e.jsx("h2",{children:"請先登入"}),e.jsxs("form",{className:"form-floating",onSubmit:s,children:[e.jsxs("div",{className:"form-floating mb-3",children:[e.jsx("input",{type:"email",className:"form-control",id:"username",name:"username",placeholder:"name@example.com",value:n.username,onChange:i,required:!0,autoFocus:!0}),e.jsx("label",{htmlFor:"username",children:"Email address"})]}),e.jsxs("div",{className:"form-floating",children:[e.jsx("input",{type:"password",className:"form-control",id:"password",name:"password",placeholder:"Password",value:n.password,onChange:i,required:!0}),e.jsx("label",{htmlFor:"password",children:"Password"})]}),e.jsx("button",{className:"btn btn-lg btn-secondary w-20 mt-4",type:"submit",children:"登入"})]})]})},y=function(){return e.jsx("div",{className:"spinner-border m-5 text-light",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})},v=function(){return document.cookie.split("; ").find(s=>s.startsWith("hexToken="))?.split("=")[1]},l=f.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=f.stopTimer,s.onmouseleave=f.resumeTimer}}),R=function({onClick:s,isChecking:n}){return e.jsxs("button",{className:"btn btn-secondary mb-5",type:"button",onClick:s,disabled:n,children:[n&&e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"確認登入狀態"]})},U=function(){return e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"產品名稱"}),e.jsx("th",{children:"原價"}),e.jsx("th",{children:"售價"}),e.jsx("th",{children:"是否啟用"}),e.jsx("th",{children:"查看細節"})]})})},_=function({product:s,onClick:n}){return e.jsxs("tr",{children:[e.jsx("td",{className:"align-middle",children:s.title}),e.jsx("td",{className:"align-middle",children:s.origin_price}),e.jsx("td",{className:"align-middle",children:s.price}),e.jsx("td",{className:"align-middle",children:s.is_enabled?"已啟用":"未啟用"}),e.jsx("td",{className:"align-middle",children:e.jsx("button",{className:"btn btn-primary",onClick:n,children:"查看細節"})})]})},q=function({products:s,onProductClick:n}){return e.jsx("tbody",{children:s.map(i=>e.jsx(_,{product:i,onClick:()=>n(i)},i.id))})},z=function(){return e.jsx("thead",{className:"spinner-border m-5 text-light",role:"status",children:e.jsx("tr",{children:e.jsx("th",{className:"visually-hidden",children:"Loading..."})})})},G=function({product:s}){return e.jsxs("div",{className:"card border-secondary mb-3",children:[s.imageUrl&&e.jsx("img",{src:s.imageUrl,className:"card-img-top primary-image",alt:s.title,referrerPolicy:"no-referrer"}),e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"card-title",children:[s.title,e.jsx("span",{className:"badge bg-secondary ms-2",children:s.category})]}),e.jsxs("p",{className:"card-text",children:["商品描述：",s.description]}),e.jsxs("p",{className:"card-text",children:["商品內容：",s.content]}),e.jsxs("div",{className:"d-flex",children:[e.jsx("p",{className:"card-text text-secondary",children:e.jsx("del",{children:s.origin_price})}),"元 /",s.price,"元"]}),e.jsx("h5",{className:"mt-3",children:"更多圖片："}),e.jsx("div",{className:"d-flex flex-wrap",children:s.imagesUrl?.map((n,i)=>n?e.jsx("img",{src:n,className:"card-img-top",alt:s.title,referrerPolicy:"no-referrer"},i):null)})]})]})},J=function(){const s="https://ec-course-api.hexschool.io/v2",n="eirene09",[i,k]=a.useState({username:"",password:""}),[u,o]=a.useState(()=>v()?"loading":"unauth"),[w,P]=a.useState([]),[j,L]=a.useState(null),[T,p]=a.useState(!1),[S,g]=a.useState(!1),[C,N]=a.useState(!1),F=function(t){const{name:r,value:d}=t.target;k(x=>({...x,[r]:d}))},E=async function(t){try{t.preventDefault(),p(!0);const r=await c.post(`${s}/admin/signin`,i),{token:d,expired:x}=r.data;document.cookie=`hexToken=${d};expires=${new Date(x)};`,c.defaults.headers.common.Authorization=d,await m(!0),o("auth"),l.fire({icon:"success",title:"Signed in successfully"})}catch{o("unauth"),l.fire({icon:"error",title:"Failed to sign in"})}finally{p(!1)}},m=a.useCallback(async function(t=!0){t&&g(!0);try{const r=await c.get(`${s}/api/${n}/admin/products`);P(r.data.products)}catch{l.fire({icon:"error",title:"Failed to load product list"})}finally{g(!1)}},[s,n]),h=a.useCallback(async function(t=!0){t&&N(!0);try{const r=v();if(r){c.defaults.headers.common.Authorization=r;const d=await c.post(`${s}/api/user/check`);await m(!1),o("auth"),t&&l.fire({icon:"success",title:"Check success: token is valid"})}else o("unauth"),t&&l.fire({icon:"error",title:"Check failed: token not found, please sign in again"})}catch{setTimeout(function(){o("unauth")},0),t&&l.fire({icon:"error",title:"Check failed: token is invalid"})}finally{t&&N(!1)}},[s,m]),b=a.useRef(!1);return a.useEffect(function(){b.current||(b.current=!0,setTimeout(()=>{h(!1)},0))},[h]),a.useEffect(()=>{const t=c.interceptors.response.use(r=>r,r=>(r.response?.status===401&&(document.cookie="hexToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT;",o("unauth"),l.fire({icon:"error",title:"Token is invalid, please sign in again"})),Promise.reject(r)));return()=>{c.interceptors.response.eject(t)}},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx($,{children:B.map(function(t){return e.jsx("li",{className:"nav-item",children:t.title==="About"?e.jsx("a",{className:"nav-link","aria-current":"page",href:t.url,children:t.title}):e.jsx("a",{className:"nav-link",href:t.url,children:t.title})},t.id)})}),u==="loading"&&e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(y,{})}),u==="auth"&&e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"row mt-5 row-col-2",children:[e.jsxs("div",{className:"col",children:[e.jsx(R,{onClick:h,isChecking:C}),e.jsx("h2",{children:"產品列表"}),e.jsxs("p",{children:["以下產品資料來源為"," ",e.jsx("a",{href:"https://www.stonexp.idv.tw/i.h?cls=40&pg=0,1",target:"_blank",rel:"noopener noreferrer",children:"石探紀：茶包的礦物化石網站"}),e.jsx("br",{}),"此列表僅供作業練習與面試使用，非商業性質用途"]}),e.jsx("table",{className:"table table-dark table-striped table-bordered border-secondary",children:S?e.jsx(z,{}):e.jsxs(e.Fragment,{children:[e.jsx(U,{}),e.jsx(q,{products:w,onProductClick:L})]})})]}),e.jsxs("div",{className:"col",children:[e.jsx("h2",{children:"單一產品細節"}),j?e.jsx(G,{product:j}):e.jsx("p",{className:"text-secondary",children:"請選擇一個商品查看"})]})]})}),u==="unauth"&&e.jsx("div",{className:"d-flex justify-content-center",children:T?e.jsx(y,{}):e.jsx(D,{onSubmit:E,formData:i,onChange:F})}),e.jsx(I,{})]})})};A.createRoot(document.getElementById("root")).render(e.jsx(a.StrictMode,{children:e.jsx(J,{})}));
