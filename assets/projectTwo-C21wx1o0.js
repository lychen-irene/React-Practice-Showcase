import{r as t,j as e,N,t as S,F as C,c as E}from"./all-CIUxKhs6.js";import{S as f,a as r,L as j,D as F,P as B,b as w}from"./ProductsLoading-Dllw-WF_.js";import{P as I,a as D}from"./ProductDetail-BwxG-UA1.js";const g=function(){return document.cookie.split("; ").find(s=>s.startsWith("hexToken="))?.split("=")[1]},c=f.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:s=>{s.onmouseenter=f.stopTimer,s.onmouseleave=f.resumeTimer}}),R=function({onClick:s,isChecking:i}){return e.jsxs("button",{className:"btn btn-secondary mb-5",type:"button",onClick:s,disabled:i,children:[i&&e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"確認登入狀態"]})},$=function(){const s="https://ec-course-api.hexschool.io/v2",i="eirene09",[u,a]=t.useState(()=>g()?"loading":"unauth"),[k,b]=t.useState([]),[m,P]=t.useState(null),[v,y]=t.useState(!1),[L,h]=t.useState(!1),[T,p]=t.useState(!1),l=t.useCallback(async function(n=!0){n&&h(!0);try{const o=await r.get(`${s}/api/${i}/admin/products`);b(o.data.products)}catch{c.fire({icon:"error",title:"Failed to load product list"})}finally{h(!1)}},[s,i]),d=t.useCallback(async function(n=!0){n&&p(!0);try{const o=g();if(o){r.defaults.headers.common.Authorization=o;const A=await r.post(`${s}/api/user/check`);await l(!1),a("auth"),n&&c.fire({icon:"success",title:"Check success: token is valid"})}else a("unauth"),n&&c.fire({icon:"error",title:"Check failed: token not found, please sign in again"})}catch{setTimeout(function(){a("unauth")},0),n&&c.fire({icon:"error",title:"Check failed: token is invalid"})}finally{n&&p(!1)}},[s,l]),x=t.useRef(!1);return t.useEffect(function(){x.current||(x.current=!0,setTimeout(()=>{d(!1)},0))},[d]),t.useEffect(()=>{const n=r.interceptors.response.use(o=>o,o=>(o.response?.status===401&&(document.cookie="hexToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT;",a("unauth"),c.fire({icon:"error",title:"Token is invalid, please sign in again"})),Promise.reject(o)));return()=>{r.interceptors.response.eject(n)}},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx(N,{title:{titles:S}}),u==="loading"&&e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(j,{})}),u==="auth"&&e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"row mt-5 row-col-2",children:[e.jsxs("div",{className:"col",children:[e.jsx(R,{onClick:d,isChecking:T}),e.jsx(F,{}),e.jsx("table",{className:"table table-dark table-striped table-bordered border-secondary",children:L?e.jsx(B,{}):e.jsx(e.Fragment,{children:e.jsx(I,{products:k,setTempProduct:P})})})]}),e.jsxs("div",{className:"col",children:[e.jsx("h2",{children:"單一產品細節"}),m?e.jsx(D,{tempProduct:m}):e.jsx("p",{className:"text-secondary",children:"請選擇一個商品查看"})]})]})}),u==="unauth"&&e.jsx("div",{className:"d-flex justify-content-center",children:v?e.jsx(j,{}):e.jsx(w,{getProducts:l,setAuthStatus:a,setIsLoginLoading:y})}),e.jsx(C,{})]})})};E.createRoot(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx($,{})}));
