import{r as e,M as C,j as t,N as D,t as I,F as R,c as B}from"./all-DAGqaRkU.js";import{S as m,a as r,L as j,D as _,P as U,b as $}from"./ProductsLoading-Cp4VV3v3.js";import{A as H,P as O,a as q,b as z,c as G}from"./Pagination-DdLk21dG.js";const P=function(){return document.cookie.split("; ").find(function(s){return s.startsWith("hexToken=")})?.split("=")[1]},l=m.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:function(s){s.onmouseenter=m.stopTimer,s.onmouseleave=m.resumeTimer}}),T={data:{id:"",title:"",category:"",origin_price:null,price:null,unit:"",description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[]}},J=function(){const s="https://ec-course-api.hexschool.io/v2",p="eirene09",[a,c]=e.useState(function(){return P()?"loading":"unauth"}),[y,b]=e.useState([]),[L,k]=e.useState({}),[v,E]=e.useState(!1),[M,f]=e.useState(!1),[S,h]=e.useState(T.data),[N,w]=e.useState(""),i=e.useCallback(async function(n=!0,o=1){n&&f(!0);try{const d=await r.get(`${s}/api/${p}/admin/products?page=${o}`);b(d.data.products),k(d.data.pagination)}catch{l.fire({icon:"error",title:"Fail to load product list"})}finally{f(!1)}},[s,p]),x=e.useCallback(async function(){try{const n=P();if(n){r.defaults.headers.common.Authorization=n;const o=await r.post(`${s}/api/user/check`);await i(!1),c("auth")}}catch{setTimeout(function(){c("unauth")},0)}},[s,i]),A=e.useRef(!1);e.useEffect(function(){!A.current&&a==="loading"&&setTimeout(function(){x()},0)},[x,a]),e.useEffect(function(){const n=r.interceptors.response.use(function(o){return o},function(o){return o.response?.status===401&&(document.cookie="hexToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT;",c("unauth"),l.fire({icon:"error",title:"Token is invalid, please sign in again"})),Promise.reject(o)});return function(){r.interceptors.response.eject(n)}},[]);const u=e.useRef(null);e.useEffect(function(){a==="auth"&&(u.current=new C("#productModal",{keyboard:!1}),document.querySelector("#productModal").addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}))},[a]);const g=function(n,o){w(n),h(function(d){return{...d,...o}}),u.current.show()},F=function(){u.current.hide()};return t.jsx(t.Fragment,{children:t.jsxs("div",{children:[t.jsx(D,{title:{titles:I}}),a==="loading"&&t.jsx("div",{className:"d-flex justify-content-center",children:t.jsx(j,{})}),a==="auth"&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"container-fluid my-4",children:t.jsxs("div",{className:"container",children:[t.jsxs("div",{className:"sticky-header py-2 my-4",children:[t.jsx(H,{openProductModal:g,INITIAL_TEMPLATE_PRODUCT_DATA:T}),t.jsx(_,{})]}),t.jsx("div",{className:"table",children:t.jsx("table",{className:"table table-dark table-striped table-bordered border-secondary",children:M?t.jsx(U,{}):t.jsx(t.Fragment,{children:t.jsx(O,{products:y,openProductModal:g})})})})]})}),t.jsx(q,{pagination:L,onChange:n=>i(!0,n)})]}),a==="unauth"&&t.jsx("div",{className:"d-flex justify-content-center",children:v?t.jsx(j,{}):t.jsx($,{Toast:l,getProducts:i,setAuthStatus:c,setIsLoginLoading:E})}),t.jsx(z,{modalType:N,ref:u,templateProductData:S,setTemplateProductData:h,closeProductModal:F,ProductModelContent:G,setIsProductsLoading:f,getProducts:i,Toast:l}),t.jsx(R,{})]})})};B.createRoot(document.getElementById("root")).render(t.jsx(e.StrictMode,{children:t.jsx(J,{})}));
