import{r as o,M as J,j as n,N as W,t as K,F as Q,c as V}from"./all-DAGqaRkU.js";import{S as y,a as c,L as b,D as X,P as Y,b as Z}from"./ProductsLoading-Dg9KhZfa.js";import{A as ee,P as te,a as ne,b as ae,c as se}from"./Pagination-BgX8NW49.js";const C=function(){return document.cookie.split("; ").find(function(i){return i.startsWith("hexToken=")})?.split("=")[1]},r=y.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:function(i){i.onmouseenter=y.stopTimer,i.onmouseleave=y.resumeTimer}}),I={data:{id:"",title:"",category:"",origin_price:null,price:null,unit:"",description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[]}},oe=function(){const i="https://ec-course-api.hexschool.io/v2",d="eirene09",[j,L]=o.useState({username:"",password:""}),[u,f]=o.useState(function(){return C()?"loading":"unauth"}),[M,S]=o.useState([]),[v,$]=o.useState({}),[E,k]=o.useState(!1),[N,m]=o.useState(!1),[p,h]=o.useState(I.data),[P,U]=o.useState(""),D=function(e){const{name:t,value:s}=e.target;L(function(a){return{...a,[t]:s}})},A=async function(e){try{e.preventDefault(),k(!0);const t=await c.post(`${i}/admin/signin`,j),{token:s,expired:a}=t.data;document.cookie=`hexToken=${s};expires=${new Date(a)};`,c.defaults.headers.common.Authorization=s,await l(!0),f("auth"),r.fire({icon:"success",title:"Sign in successfully"})}catch{f("unauth"),r.fire({icon:"error",title:"Fail to sign in"})}finally{k(!1)}},l=o.useCallback(async function(e=!0,t=1){e&&m(!0);try{const s=await c.get(`${i}/api/${d}/admin/products?page=${t}`);S(s.data.products),$(s.data.pagination)}catch{r.fire({icon:"error",title:"Fail to load product list"})}finally{m(!1)}},[i,d]),F=async function(e,t=!0){t&&m(!0);const s={data:{...p,origin_price:Number(p.origin_price),price:Number(p.price),imagesUrl:[...p.imagesUrl.filter(a=>a!=="")]}};if(P==="create")try{const a=await c.post(`${i}/api/${d}/admin/product`,s);await l(!1),r.fire({icon:"success",title:"Create a new product successfully"})}catch{r.fire({icon:"error",title:"Fail to create a new product"})}finally{m(!1),x()}else try{const a=await c.put(`${i}/api/${d}/admin/product/${e}`,s);await l(!1),r.fire({icon:"success",title:"Update product successfully"})}catch{r.fire({icon:"error",title:"Fail to update product"})}finally{m(!1),x()}},_=async e=>{try{const t=await c.delete(`${i}/api/${d}/admin/product/${e}`);r.fire({icon:"success",title:"Delete product successfully"})}catch{r.fire({icon:"error",title:"Fail to delete product"})}finally{x(),l(!1)}},w=o.useCallback(async function(){try{const e=C();if(e){c.defaults.headers.common.Authorization=e;const t=await c.post(`${i}/api/user/check`);await l(!1),f("auth")}}catch{setTimeout(function(){f("unauth")},0)}},[i,l]),R=o.useRef(!1);o.useEffect(function(){!R.current&&u==="loading"&&setTimeout(function(){w()},0)},[w,u]),o.useEffect(function(){const e=c.interceptors.response.use(function(t){return t},function(t){return t.response?.status===401&&(document.cookie="hexToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT;",f("unauth"),r.fire({icon:"error",title:"Token is invalid, please sign in again"})),Promise.reject(t)});return function(){c.interceptors.response.eject(e)}},[]);const g=o.useRef(null);o.useEffect(function(){u==="auth"&&(g.current=new J("#productModal",{keyboard:!1}),document.querySelector("#productModal").addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}))},[u]);const T=function(e,t){U(e),h(function(s){return{...s,...t}}),g.current.show()},x=function(){g.current.hide()},B=function(e){const{name:t,value:s,checked:a,type:q}=e.target;h(function(G){return{...G,[t]:q==="checkbox"?a:s}})},z=function(e,t){h(function(s){const a=[...s.imagesUrl];return a[e]=t,t!==""&&e===a.length-1&&a.length<5&&a.push(""),t===""&&a.length>1&&a[a.length-1]===""&&a.pop(),{...s,imagesUrl:a}})},H=()=>{h(function(e){const t=[...e.imagesUrl];return t.push(""),{...e,imagesUrl:t}})},O=()=>{h(function(e){const t=[...e.imagesUrl];return t.pop(),{...e,imagesUrl:t}})};return n.jsx(n.Fragment,{children:n.jsxs("div",{children:[n.jsx(W,{title:{titles:K}}),u==="loading"&&n.jsx("div",{className:"d-flex justify-content-center",children:n.jsx(b,{})}),u==="auth"&&n.jsx("div",{className:"container-fluid my-4",children:n.jsxs("div",{className:"container",children:[n.jsxs("div",{className:"sticky-header py-2 my-4",children:[n.jsx(ee,{onClick:()=>T("create",I.data)}),n.jsx(X,{})]}),n.jsx("div",{className:"table",children:n.jsx("table",{className:"table table-dark table-striped table-bordered border-secondary",children:N?n.jsx(Y,{}):n.jsx(n.Fragment,{children:n.jsx(te,{products:M,openProductModal:T})})})})]})}),u==="unauth"&&n.jsx("div",{className:"d-flex justify-content-center",children:E?n.jsx(b,{}):n.jsx(Z,{onSubmit:A,formData:j,onChange:D})}),n.jsx(ne,{modalType:P,ref:g,onClick:x,templateProductData:p,onChange:B,onImgChange:z,onClickAddImg:H,onClickDeleteImg:O,updateProducts:F,deleteProductData:_,ProductModelContent:ae}),n.jsx(se,{pagination:v,onChange:e=>l(!0,e)}),n.jsx(Q,{})]})})};V.createRoot(document.getElementById("root")).render(n.jsx(o.StrictMode,{children:n.jsx(oe,{})}));
