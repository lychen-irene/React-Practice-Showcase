import{r as l,j as e,N as Q,t as X,F as Y,c as Z}from"./all-DQqp6yhR.js";import{S as C,a as h}from"./sweetalert2.esm.all-DOjieFrw.js";import{M as D}from"./bootstrap.esm-G50tnjl1.js";const ee=function({onSubmit:t,formData:n,onChange:i}){return e.jsxs("div",{className:"container login",children:[e.jsx("h2",{children:"請先登入"}),e.jsxs("form",{className:"form-floating",onSubmit:t,children:[e.jsxs("div",{className:"form-floating mb-3",children:[e.jsx("input",{type:"email",className:"form-control",id:"username",name:"username",placeholder:"name@example.com",value:n.username,onChange:i,required:!0,autoFocus:!0}),e.jsx("label",{htmlFor:"username",children:"Email address"})]}),e.jsxs("div",{className:"form-floating",children:[e.jsx("input",{type:"password",className:"form-control",id:"password",name:"password",placeholder:"Password",value:n.password,onChange:i,required:!0}),e.jsx("label",{htmlFor:"password",children:"Password"})]}),e.jsx("button",{className:"btn btn-lg btn-secondary w-20 mt-4",type:"submit",children:"登入"})]})]})},I=function(){return e.jsx("div",{className:"spinner-border m-5 text-light",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})},M=function(){return document.cookie.split("; ").find(function(t){return t.startsWith("hexToken=")})?.split("=")[1]},o=C.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:function(t){t.onmouseenter=C.stopTimer,t.onmouseleave=C.resumeTimer}}),te=function({onClick:t}){return e.jsx("div",{className:"text-end mt-4",children:e.jsx("button",{className:"btn btn-primary mb-5",type:"button",onClick:t,children:"建立新的產品"})})},S={data:{id:"",title:"",category:"",origin_price:null,price:null,unit:"",description:"",content:"",is_enabled:0,imageUrl:"",imagesUrl:[]}},se=function(){return e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"產品分類"}),e.jsx("th",{children:"產品名稱"}),e.jsx("th",{children:"原價"}),e.jsx("th",{children:"售價"}),e.jsx("th",{children:"是否啟用"}),e.jsx("th",{children:"編輯"})]})})},ne=function({product:t,openProductModal:n}){return e.jsxs("tr",{children:[e.jsx("td",{className:"align-middle",children:t.category}),e.jsx("td",{className:"align-middle",children:t.title}),e.jsx("td",{className:"align-middle",children:t.origin_price}),e.jsx("td",{className:"align-middle",children:t.price}),e.jsx("td",{className:`align-middle ${t.is_enabled?"":"text-secondary"}`,children:t.is_enabled?"已啟用":"未啟用"}),e.jsx("td",{className:"align-middle",children:e.jsxs("div",{className:"btn-group",role:"group","aria-label":"Basic example",children:[e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>n("edit",t),children:"編輯"}),e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>n("delete",t),children:"刪除"})]})})]})},ae=function({products:t,openProductModal:n}){return e.jsx("tbody",{children:t.map(function(i){return e.jsx(ne,{product:i,openProductModal:n},i.id)})})},ie=function({modalType:t,productModalRef:n,templateProductData:i,onChange:f,onImgChange:d,onClickAddImg:u,onClickDeleteImg:b,closeProductModal:g,updateProducts:m,deleteProductData:x}){return e.jsx("div",{className:"modal fade",id:"productModal",tabIndex:"-1","aria-labelledby":"productModal","aria-hidden":"true",ref:n,children:e.jsx(re,{modalType:t,templateProductData:i,closeProductModal:g,onChange:f,onImgChange:d,onClickAddImg:u,onClickDeleteImg:b,updateProducts:m,deleteProductData:x})})},re=function({modalType:t,templateProductData:n,onChange:i,onImgChange:f,onClickAddImg:d,onClickDeleteImg:u,closeProductModal:b,updateProducts:g,deleteProductData:m}){return e.jsx("div",{className:"modal-dialog modal-xl",children:e.jsxs("div",{className:"modal-content border-0",children:[e.jsxs("div",{className:`modal-header text-white 
          bg-${t==="delete"?"danger":"black"}`,children:[e.jsx("h5",{id:"productModalLabel",className:"modal-title",children:t==="create"?e.jsx("span",{children:"新增產品"}):t==="edit"?e.jsx("span",{children:"編輯產品"}):e.jsx("span",{children:"刪除產品"})}),e.jsx("button",{type:"button",className:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body bg-black text-white text-start",children:t==="delete"?e.jsxs("p",{className:"fs-4",children:["確定要刪除",e.jsx("span",{className:"text-red",children:n.title}),"嗎？"]}):e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-sm-4",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"imageUrl",className:"form-label",children:"輸入圖片網址"}),e.jsx("input",{type:"text",id:"imageUrl",name:"imageUrl",className:"form-control",placeholder:"請輸入圖片連結",defaultValue:n.imageUrl,onChange:i})]}),n.imageUrl&&e.jsx("img",{className:"img-fluid",src:n.imageUrl,alt:"主圖",referrerPolicy:"no-referrer"})]}),e.jsxs("div",{children:[n.imagesUrl.map(function(x,j){return e.jsxs("div",{children:[e.jsx("label",{htmlFor:"imageUrl",className:"form-label",children:"輸入圖片網址"}),e.jsx("input",{type:"text",className:"form-control",placeholder:`圖片網址${j+1}`,defaultValue:x,onChange:F=>f(j,F.target.value)}),x&&e.jsx("img",{className:"img-fluid",src:x,alt:`副圖${j+1}`,referrerPolicy:"no-referrer"})]},j)}),e.jsx("button",{className:"btn btn-primary btn-sm d-block w-100 mt-2",onClick:d,children:"新增圖片"})]}),e.jsx("div",{children:e.jsx("button",{className:"btn btn-danger btn-sm d-block w-100 mt-2",onClick:u,children:"刪除圖片"})})]}),e.jsxs("div",{className:"col-sm-8",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"title",className:"form-label",children:"標題"}),e.jsx("input",{name:"title",id:"title",type:"text",className:"form-control",placeholder:"請輸入標題",defaultValue:n.title,onChange:i})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"category",className:"form-label",children:"分類"}),e.jsx("input",{name:"category",id:"category",type:"text",className:"form-control",placeholder:"請輸入分類",defaultValue:n.category,onChange:i})]}),e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"unit",className:"form-label",children:"單位"}),e.jsx("input",{name:"unit",id:"unit",type:"text",className:"form-control",placeholder:"請輸入單位",defaultValue:n.unit,onChange:i})]})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"origin_price",className:"form-label",children:"原價"}),e.jsx("input",{name:"origin_price",id:"origin_price",type:"number",min:"0",className:"form-control",placeholder:"請輸入原價",defaultValue:n.origin_price,onChange:i})]}),e.jsxs("div",{className:"mb-3 col-md-6",children:[e.jsx("label",{htmlFor:"price",className:"form-label",children:"售價"}),e.jsx("input",{name:"price",id:"price",type:"number",min:"0",className:"form-control",placeholder:"請輸入售價",defaultValue:n.price,onChange:i})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"產品描述"}),e.jsx("textarea",{name:"description",id:"description",className:"form-control",placeholder:"請輸入產品描述",defaultValue:n.description,onChange:i})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"content",className:"form-label",children:"說明內容"}),e.jsx("textarea",{name:"content",id:"content",className:"form-control",placeholder:"請輸入說明內容",defaultValue:n.content,onChange:i})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{name:"is_enabled",id:"is_enabled",className:"form-check-input",type:"checkbox",checked:!!n.is_enabled,onChange:i}),e.jsx("label",{className:"form-check-label",htmlFor:"is_enabled",children:"是否啟用"})]})})]})]})}),e.jsxs("div",{className:"modal-footer bg-black",children:[e.jsx("button",{type:"button",className:"btn btn-dark","data-bs-dismiss":"modal",onClick:b,children:"取消"}),t==="delete"?e.jsx("button",{type:"button",className:"btn btn-danger",onClick:()=>m(n.id),children:"刪除"}):e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>g(n.id),children:"確認"})]})]})})},le=function(){return e.jsx("thead",{className:"spinner-border m-5 text-light",role:"status",children:e.jsx("tr",{children:e.jsx("th",{className:"visually-hidden",children:"Loading..."})})})},ce=function({totalPage:t,setProductPage:n}){return Array.from({length:t},(i,f)=>e.jsx("button",{type:"button",className:"btn btn-black text-white px-2 mx-1 mb-4",onClick:()=>n(f+1),children:f+1},f))},oe=function(){const t="https://ec-course-api.hexschool.io/v2",n="eirene09",[i,f]=l.useState({username:"",password:""}),[d,u]=l.useState(function(){return M()?"loading":"unauth"}),[b,g]=l.useState([]),[m,x]=l.useState(1),[j,F]=l.useState(0),[E,_]=l.useState(!1),[A,N]=l.useState(!1),[y,v]=l.useState(S.data),[U,V]=l.useState(""),R=function(s){const{name:a,value:c}=s.target;f(function(r){return{...r,[a]:c}})},B=async function(s){try{s.preventDefault(),_(!0);const a=await h.post(`${t}/admin/signin`,i),{token:c,expired:r}=a.data;document.cookie=`hexToken=${c};expires=${new Date(r)};`,h.defaults.headers.common.Authorization=c,await p(!0),u("auth"),o.fire({icon:"success",title:"Sign in successfully"})}catch{u("unauth"),o.fire({icon:"error",title:"Fail to sign in"})}finally{_(!1)}},p=l.useCallback(async function(s=!0){s&&N(!0);try{const a=await h.get(`${t}/api/${n}/admin/products?page=${m}`);g(a.data.products),x(a.data.pagination.current_page),F(a.data.pagination.total_pages)}catch{o.fire({icon:"error",title:"Fail to load product list"})}finally{N(!1)}},[t,n,m]),q=async function(s,a=!0){a&&N(!0);const c={data:{...y,origin_price:Number(y.origin_price),price:Number(y.price),imagesUrl:[...y.imagesUrl.filter(r=>r!=="")]}};if(U==="create")try{const r=await h.post(`${t}/api/${n}/admin/product`,c);await p(!0),o.fire({icon:"success",title:"Create a new product successfully"})}catch{o.fire({icon:"error",title:"Fail to create a new product"})}finally{N(!1),w()}else try{const r=await h.put(`${t}/api/${n}/admin/product/${s}`,c);await p(!0),o.fire({icon:"success",title:"Update product successfully"})}catch{o.fire({icon:"error",title:"Fail to update product"})}finally{N(!1),w()}},z=async s=>{try{const a=await h.delete(`${t}/api/${n}/admin/product/${s}`);o.fire({icon:"success",title:"Delete product successfully"})}catch{o.fire({icon:"error",title:"Fail to delete product"})}finally{w(),p(!1)}},L=l.useCallback(async function(s=!0){try{const a=M();if(a){h.defaults.headers.common.Authorization=a;const c=await h.post(`${t}/api/user/check`);await p(!1),u("auth"),s&&o.fire({icon:"success",title:"Check success: token is valid"})}else u("unauth"),o.fire({icon:"error",title:"Check failed: token not found, please sign in again"})}catch{setTimeout(function(){u("unauth")},0),s&&o.fire({icon:"error",title:"Check failed: token is invalid"})}},[t,p]),T=l.useRef(!1);l.useEffect(function(){T.current||(T.current=!0,setTimeout(function(){L(!1)},0))},[L]),l.useEffect(function(){const s=h.interceptors.response.use(function(a){return a},function(a){return a.response?.status===401&&(document.cookie="hexToken=; expires=Thu, 01 Jan 1970 00:00:00 GMT;",u("unauth"),o.fire({icon:"error",title:"Token is invalid, please sign in again"})),Promise.reject(a)});return function(){h.interceptors.response.eject(s)}},[]);const k=l.useRef(null);l.useEffect(function(){d==="auth"&&(k.current=new D("#productModal",{keyboard:!1}),document.querySelector("#productModal").addEventListener("hide.bs.modal",()=>{document.activeElement instanceof HTMLElement&&document.activeElement.blur()}))},[d]);const P=function(s,a){V(s),v(function(c){return{...c,...a}}),k.current.show()},w=function(){k.current.hide()},O=function(s){const{name:a,value:c,checked:r,type:W}=s.target;v(function(K){return{...K,[a]:W==="checkbox"?r:c}})},G=function(s,a){v(function(c){const r=[...c.imagesUrl];return r[s]=a,a!==""&&s===r.length-1&&r.length<5&&r.push(""),a===""&&r.length>1&&r[r.length-1]===""&&r.pop(),{...c,imagesUrl:r}})},H=()=>{v(function(s){const a=[...s.imagesUrl];return a.push(""),{...s,imagesUrl:a}})},J=()=>{v(function(s){const a=[...s.imagesUrl];return a.pop(),{...s,imagesUrl:a}})},$=l.useRef(m);return l.useEffect(function(){d==="auth"&&$.current!==m&&p(!0),$.current=m},[m,d,p]),e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx(Q,{children:X.map(function(s){return e.jsx("li",{className:"nav-item",children:s.title==="About"?e.jsx("a",{className:"nav-link","aria-current":"page",href:s.url,children:s.title}):e.jsx("a",{className:"nav-link",href:s.url,children:s.title})},s.id)})}),d==="loading"&&e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(I,{})}),d==="auth"&&e.jsx("div",{className:"container-fluid my-4",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"sticky-header py-2 my-4",children:[e.jsx(te,{onClick:()=>P("create",S.data)}),e.jsx("h2",{children:"產品列表"}),e.jsxs("p",{children:["以下產品資料來源為",e.jsx("a",{href:"https://www.stonexp.idv.tw/i.h?cls=40&pg=0,1",target:"_blank",rel:"noopener noreferrer",children:"石探紀：茶包的礦物化石網站"}),e.jsx("br",{}),"此列表僅供作業練習與面試使用，非商業性質用途"]})]}),e.jsx("div",{className:"table",children:e.jsx("table",{className:"table table-dark table-striped table-bordered border-secondary",children:A?e.jsx(le,{}):e.jsxs(e.Fragment,{children:[e.jsx(se,{}),e.jsx(ae,{products:b,openProductModal:P})]})})})]})}),d==="unauth"&&e.jsx("div",{className:"d-flex justify-content-center",children:E?e.jsx(I,{}):e.jsx(ee,{onSubmit:B,formData:i,onChange:R})}),e.jsx(ie,{modalType:U,ref:k,onClick:w,templateProductData:y,onChange:O,onImgChange:G,onClickAddImg:H,onClickDeleteImg:J,updateProducts:q,deleteProductData:z}),e.jsx(ce,{totalPage:j,setProductPage:x}),e.jsx(Y,{})]})})};Z.createRoot(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx(oe,{})}));
